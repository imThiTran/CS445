<%- include ('../layouts/header') %>
        <div class="ad-movie">
            <div class="h5-detail">Quản lý phim</div>
            <span class="line-detail"></span>
                <table class="table table-striped  table-bordered" style="font-size: 15px;">
                    <thead>
                        <tr>
                            <th scope="col"></th>
                            <th scope="col">Tên phim</th>
                            <th scope="col">Đạo diễn</th>
                            <th scope="col">Khởi chiếu</th>
                            <th scope="col">Thể loại</th>
                            <th scope="col">Rating</th>
                            <th scope="col">Tình trạng</th>
                            <th scope="col" style="width: 1%;">
                                <div class="btn-admin">
                                    <button type="button" class="btn btn-danger btn-buy btn-sua" data-toggle="modal" data-target=".bd-example-modal-lg" 
                                    >+</button>
                                    
                                        <form action="" class="formAdd">
                                            <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-lg">
                                                  <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Thêm phim</h4>
                                                            <button type="button" class="close"
                                                                data-dismiss="modal">&times;</button>
                                                        </div>
        
                                                        <div class="modal-body-plus">
                                                            <div class="modal-left">
                                                                <div class="col-5 img-add">
                                                                    <img id="img-edit-item" class="imgAddPreview"
                                                                        src="/img/noimage.png" style="width: 100%;">
                                                                    <input type="file" class="form-control imgChangeAdd" name="image"
                                                                        id="img1" accept="image/png, image/jpeg, image/jpg"
                                                                        style="display: none;">
                                                                    <label class="btn-addimg" id="btn-edit-img-item" for="img1">Chọn ảnh</label>
                                                                </div>
                                                            </div>
                                                            <div class="modal-right">
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Tên phim</label>
                                                                    <div class="input-ten">
                                                                        <input class="input-sua" placeholder="Tên tiếng anh" name="nameEN" type="text">
                                                                        <input class="input-sua" placeholder="Tên tiếng việt" name="nameVN" type="text">
                                                                    </div>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Đạo diễn</label>
                                                                    <input class="input-sua" name="director" type="text">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Diễn viên</label>
                                                                    <input class="input-sua" name="actor" type="text">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Khởi chiếu</label>
                                                                    <input class="input-sua" name="showdate" type="date">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Thời gian</label>
                                                                    <input class="input-sua" name="time" type="number">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Thể loại</label>
                                                                    <select class="input-sua" name="type" id="">
                                                                        <option value="kd">Kinh dị</option>
                                                                        <option value="tc">Tình cảm</option>
                                                                        <option value="hd">Hành động</option>
                                                                        <option value="hhc">Hài hước</option>
                                                                        <option value="hhh">Hoạt hình</option>
                                                                        <option value="ls">Lịch sử</option>
                                                                    </select>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Rating</label>
                                                                    <div style="display: flex; justify-content: center;">
                                                                    <div class="form-check rating">
                                                                        <input class="form-check-input" value="18" type="radio" name="agelimit" id="flexRadioDefault1">
                                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                                            <img class="img-cs" style="width: 50%;" src="/img/cs18.png">
                                                                        </label>
                                                                      </div>
                                                                      <div class="form-check rating">
                                                                        <input class="form-check-input" value="16" type="radio" name="agelimit" id="flexRadioDefault1">
                                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                                            <img class="img-cs" style="width: 50%;" src="/img/cs16.png">
                                                                        </label>
                                                                      </div>
                                                                      <div class="form-check rating">
                                                                        <input class="form-check-input" value="13" type="radio" name="agelimit" id="flexRadioDefault1">
                                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                                            <img class="img-cs" style="width: 50%;" src="/img/cs13.png">
                                                                        </label>
                                                                      </div>
                                                                    </div>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Tình trạng</label>
                                                                    <select class="input-sua" name="status" id="">
                                                                        <option value="showing">Đang khởi chiếu</option>
                                                                        <option value="coming">Sắp khởi chiếu</option>
                                                                        <option value="showed">Đã chiếu xong</option>
                                                                    </select>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Chi tiết</label>
                                                                    <textarea class="input-sua-area" name="detail" id="" cols="20" rows="10"></textarea>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Link Trailer</label>
                                                                    <input class="input-sua" name="trailerId" type="url">
                                                                </div>
                                                            </div>
                                                                
                                                            </div>
                                                        <div class="modal-footer">
                                                            <p style="color: red;" class="alertFilm"></p>
                                                            <button type="button" id="btn-save-new-item" class="btn btn-danger">Thêm</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <%films.forEach(function(film){%>
                            <tr>
                                <th scope="row" style="width: 15%"> 
                                    <img style="width: 100%" src="/img/films/<%=film._id%>/<%=film.photo%>" alt="">
                                </th>
                                <td style="width: 20%;">
                                    <div><%=film.nameEN%></div>
                                    <div><%=film.nameVN%></div>
                                </td>
                                <td><%=film.director%></td>
                                <td><%=film.showdate%></td>
                                <td><%=film.type%></td>
                                <td>
                                    <%if (film.agelimit==18){%>
                                        <img class="img-cs" style="width:50px" src="../img/cs18.png">
                                    <%} else if (film.agelimit==16){%>
                                        <img class="img-cs" style="width:50px" src="../img/cs16.png">
                                    <%} else {%>
                                        <img class="img-cs" style="width:50px" src="../img/cs13.png">
                                    <%}%> 
                                </td>
                                <td >
                                    <div><%=film.status%></div>
                                </td>
                                    <td>
                                        <div class="ad-btn"style="width:60px">
                                        <button type="button"
                                        class="btn-close btn-xoa"
                                        aria-label="Close" style="margin-top: 10px;"></button>
                                        <button type="button" class="btn btn-danger btn-buy btn-sua" data-toggle="modal" data-target=".bd-example-modal-lg1" 
                                        >Sửa</button>
                                        <button type="button" class="btn btn-danger btn-buy btn-sua" data-toggle="modal" data-target=".bd-example-modal-lg2" 
                                        >Chi tiết</button></div></td>
                                        <!-- form nút sửa -->
                                        <form action="">
                                            <div class="modal fade bd-example-modal-lg1" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-lg">
                                                  <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Sửa phim</h4>
                                                            <button type="button" class="close"
                                                                data-dismiss="modal">&times;</button>
                                                        </div>
        
                                                        <div class="modal-body-plus">
                                                            <div class="modal-left">
                                                                <div class="col-5 img-add">
                                                                    <img id="img-edit-item" class="imgAddPreview"
                                                                        src="img/trasua.jpg" style="width: 100%;">
                                                                    <input type="file" class="form-control imgChangeAdd" name="image"
                                                                        id="img2" accept="image/png, image/jpeg, image/jpg"
                                                                        style="display: none;">
                                                                    <label style="font-weight: 700;" class="btn-addimg" id="btn-edit-img-item" for="img2">Chọn ảnh</label>
                                                                </div>
                                                            </div>
                                                            <div class="modal-right">
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Tên phim</label>
                                                                    <div class="input-ten">
                                                                        <input class="input-sua" placeholder="Tên tiếng anh" type="text">
                                                                        <input class="input-sua" placeholder="Tên tiếng việt" type="text">
                                                                    </div>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Đạo diễn</label>
                                                                    <input class="input-sua" type="text">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Diễn viên</label>
                                                                    <input name="actor" class="input-sua" type="text">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Khởi chiếu</label>
                                                                    <input class="input-sua" type="date">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Thời gian</label>
                                                                    <input class="input-sua" type="number">
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Thể loại</label>
                                                                    <select class="input-sua" name="" id="">
                                                                        <option value="kd">Kinh dị</option>
                                                                        <option value="tc">Tình cảm</option>
                                                                        <option value="hd">Hành động</option>
                                                                        <option value="hhc">Hài hước</option>
                                                                        <option value="hhh">Hoạt hình</option>
                                                                        <option value="ls">Lịch sử</option>
                                                                    </select>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Rating</label>
                                                                    <div style="display: flex; justify-content: center;">
                                                                    <div class="form-check rating">
                                                                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                                            <img class="img-cs" style="width: 50%;" src="img/cs18.png">
                                                                        </label>
                                                                      </div>
                                                                      <div class="form-check rating">
                                                                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                                            <img class="img-cs" style="width: 50%;" src="img/cs16.png">
                                                                        </label>
                                                                      </div>
                                                                      <div class="form-check rating">
                                                                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                                            <img class="img-cs" style="width: 50%;" src="img/cs13.png">
                                                                        </label>
                                                                      </div>
                                                                    </div>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Tình trạng</label>
                                                                    <select class="input-sua" name="" id="">
                                                                        <option value="1">Đang khởi chiếu</option>
                                                                        <option value="2">Sắp khởi chiếu</option>
                                                                        <option value="3">Đã chiếu xong</option>
                                                                    </select>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Chi tiết</label>
                                                                    <textarea class="input-sua-area" name="" id="" cols="20" rows="10"></textarea>
                                                                </div>
                                                                <div class="ad-phim">
                                                                    <label class="label-chitiet" for="">Trailer</label>
                                                                    <input class="input-sua" type="url">
                                                                </div>
                                                            </div>
                                                                
                                                            </div>
                                                        <div class="modal-footer">                                                      
                                                            <button type="button" class="btn btn-danger">Thêm</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <!-- form nút chi tiết -->
                                        <form action="">
                                            <div class="modal fade bd-example-modal-lg2" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-lg">
                                                  <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Chi tiết phim</h4>
                                                            <button type="button" class="close"
                                                                data-dismiss="modal">&times;</button>
                                                        </div>
        
                                                        <div class="modal-body-plus">
                                                            <div class="modal-left">
                                                                <div class="col-5 img-add">
                                                                    <img id="img-edit-item" class="imgAddPreview"
                                                                        src="/img/films/<%=film._id%>/<%=film.photo%>" style="width: 100%;">
                                                                    
                                                                </div>
                                                            </div>
                                                            <div class="modal-right">
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Tên phim</label>
                                                                <div>
                                                                <div><%=film.nameEN%></div>
                                                                <div><%=film.nameVN%></div></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Đạo diễn</label>
                                                                <div><%=film.director%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Diễn viên</label>
                                                                <div><%=film.actor%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Khởi chiếu</label>
                                                                <div><%=film.showdate%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Thời gian</label>
                                                                <div><%=film.time%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Thể loại</label>
                                                                <div><%=film.type%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Rating</label>
                                                                <div>
                                                                    <%if (film.agelimit==18){%>
                                                                        <img class="img-cs" style="width:50px" src="../../img/cs18.png">
                                                                    <%} else if (film.agelimit==16){%>
                                                                        <img class="img-cs" style="width:50px" src="../../img/cs16.png">
                                                                    <%} else {%>
                                                                        <img class="img-cs" style="width:50px" src="../../img/cs13.png">
                                                                    <%}%>
                                                                    
                                                                </div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Tình trạng</label>
                                                                <div><%=film.status%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Chi tiết</label>
                                                                <div style="width: 75%"><%=film.detail%></div>
                                                            </div>
                                                            <div class="ad-phim">
                                                                <label class="label-chitiet" for="">Trailer</label>
                                                                <iframe width="560" height="315" src="https://www.youtube.com/embed/<%=film.trailerId%>"
                                                                    title="YouTube video player" frameborder="0"
                                                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                                                    allowfullscreen></iframe>
                                                                </iframe>
                                                            </div>
                                                        </div>
                                                            
                                                        </div>
                                                        <div class="modal-footer">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>   
                        </tr>
                        <%})%>
                    </tbody>
                </table>
        </div>
</body>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
    $('#btn-save-new-item').on('click',function(e){
  var formm=$('.formAdd')[0];
  var data = new FormData(formm);
  $.ajax({
    url: "/admin/film/add-film/",
    type: "POST",
    enctype: "multipart/form-data",
    cache:false,
    processData: false,
    contentType: false,
    data: data,
    success: function (result) {
          if ( result.noti != "") $('.alertFilm').text(result.noti) ;
           else {
             // Set the URL to whatever it was plus "#".
             url = document.URL+"#";
             location = "#";

             //Reload the page
              location.reload(true);
           }
      }
  });
  e.preventDefault();
}) 


// $('.info-film').each(function () {
//   var $this = $(this);
//   var modalInfo1 = $this.closest('each-tr').find('.modal-info');
// //   var CloseModal = $this.parent().find('.close-footer-info');
  
//   $this.on('click',function(){
//     modalInfo1.css("display","block"); 
//   })

// //   CloseModal.on('click',function(){
// //         modalInfo1.css("display","none"); 
// //       })
// })
 </script>
<script>
    $('a.confirmDeletion').on('click', function () {
        if (!confirm('Confirm Deletion ? '))
            return false;
    })
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $(".imgEditPreview").attr('src', e.target.result);
                $(".imgAddPreview").attr('src', e.target.result);
                
            }
            reader.readAsDataURL(input.files[0]);
        }
    }



    $(".imgChangeAdd").change(function () {
        readURL(this);
    })

    $(".imgChangeEdit").change(function () {
        readURL(this);
    })




</script>

</html>